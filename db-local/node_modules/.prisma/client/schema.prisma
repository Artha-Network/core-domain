datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id         Int      @id @default(autoincrement())
  wallet     String   @unique
  name       String?
  reputation Int      @default(0)
  createdAt  DateTime @default(now())

  dealsAsBuyer  Deal[] @relation("BuyerDeals")
  dealsAsSeller Deal[] @relation("SellerDeals")
}

model Deal {
  id                 Int        @id @default(autoincrement())
  buyerId            Int
  sellerId           Int
  priceUsd           Decimal    @db.Decimal(10, 2)
  description        String?
  fundingDeadline    DateTime?
  completionDeadline DateTime?
  status             DealStatus
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt

  buyer  User @relation("BuyerDeals", fields: [buyerId], references: [id])
  seller User @relation("SellerDeals", fields: [sellerId], references: [id])
}

enum DealStatus {
  INIT
  FUNDED
  DISPUTED
  RESOLVED
  RELEASED
  REFUNDED
}
